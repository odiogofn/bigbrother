<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Admin - Painel</title>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const SUPABASE_URL = "https://biojnilbgzozmynemtra.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpb2puaWxiZ3pvem15bmVtdHJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDM5MzEsImV4cCI6MjA3MjIxOTkzMX0.F8MyL33SdQ7RViOF5RWgoZh8vC6hsyNqmqUXmRcNPDM";

    let supabase = null;

    window.addEventListener("DOMContentLoaded", () => {
      // LOGIN DO ADMIN
      document.getElementById("login-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        if (username === "admin" && password === "admin") {
          supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

          document.getElementById("login-section").classList.add("hidden");
          document.getElementById("dashboard").classList.remove("hidden");

          carregarJogadores(); // já carrega lista ao entrar
        } else {
          alert("Usuário ou senha incorretos!");
        }
      });

      // CADASTRAR JOGADOR
      document.getElementById("form-cadastrar-jogador").addEventListener("submit", async (e) => {
        e.preventDefault();
        const nome = document.getElementById("nome-jogador").value.trim();
        const nascimento = document.getElementById("nascimento-jogador").value;

        if (!supabase) return alert("Você não está logado.");

        const { error } = await supabase.from("jogadores").insert([
          { nome, nascimento }
        ]);

        if (error) {
          console.error(error);
          alert("Erro ao cadastrar jogador!");
        } else {
          alert("Jogador cadastrado!");
          document.getElementById("form-cadastrar-jogador").reset();
          carregarJogadores();
        }
      });
    });

    // LISTAR JOGADORES
    async function carregarJogadores() {
      if (!supabase) return;

      const { data, error } = await supabase.from("jogadores").select("*").order("nome");

      if (error) {
        console.error(error);
        return;
      }

      const lista = document.getElementById("lista-jogadores");
      lista.innerHTML = "";
      data.forEach(j => {
        const li = document.createElement("li");
        li.textContent = `${j.nome} - Nascimento: ${j.nascimento}`;
        lista.appendChild(li);
      });
    }
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .card { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    nav { margin-bottom: 20px; }
    nav button { margin-right: 10px; }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <section id="login-section">
    <h2>Login do Admin</h2>
    <form id="login-form">
      <label>Usuário:</label><br>
      <input type="text" id="username" required><br><br>
      <label>Senha:</label><br>
      <input type="password" id="password" required><br><br>
      <button type="submit">Entrar</button>
    </form>
  </section>

  <!-- DASHBOARD ADMIN -->
  <section id="dashboard" class="hidden">
    <h2>Painel do Admin</h2>

    <nav>
      <button onclick="document.getElementById('cadastrar-jogador').classList.remove('hidden');document.getElementById('resultados').classList.add('hidden');">
        Cadastrar Jogador
      </button>
      <button onclick="document.getElementById('resultados').classList.remove('hidden');document.getElementById('cadastrar-jogador').classList.add('hidden');">
        Resultados
      </button>
    </nav>

    <!-- CADASTRAR JOGADOR -->
    <div id="cadastrar-jogador" class="card">
      <h3>Cadastrar Jogador</h3>
      <form id="form-cadastrar-jogador">
        <label>Nome:</label><br>
        <input type="text" id="nome-jogador" required><br><br>
        <label>Data de Nascimento:</label><br>
        <input type="date" id="nascimento-jogador" required><br><br>
        <button type="submit">Salvar</button>
      </form>
      <h4>Jogadores Cadastrados</h4>
      <ul id="lista-jogadores"></ul>
    </div>

    <!-- RESULTADOS -->
    <div id="resultados" class="card hidden">
      <h3>Cadastrar Resultados por Semana</h3>
      <p>Aqui você poderá selecionar a semana e cadastrar o gabarito para cada jogador automaticamente listado.</p>
      <!-- futuramente: tabela dinâmica puxando jogadores -->
    </div>
  </section>
</body>
</html>
