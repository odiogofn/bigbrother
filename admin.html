<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gigant Brother - Painel Admin</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
<script src="supabase.js"></script> <!-- arquivo separado -->
</head>
<body class="bg-gray-100 font-sans">

<div class="max-w-7xl mx-auto p-4">

  <h1 class="text-3xl font-bold text-center mb-6 text-indigo-600">Gigant Brother - Painel Admin</h1>

  <!-- Login Admin -->
  <div id="login-section" class="max-w-md mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-xl font-semibold mb-4">Login Admin</h2>
    <form id="login-form" class="space-y-4">
      <input type="text" id="admin-username" placeholder="Usuário" class="w-full p-2 border rounded">
      <input type="password" id="admin-password" placeholder="Senha" class="w-full p-2 border rounded">
      <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700">Entrar</button>
      <p id="login-error" class="text-red-500 hidden">Usuário ou senha incorretos.</p>
    </form>
  </div>

  <!-- Dashboard Admin -->
  <div id="dashboard" class="hidden">

    <!-- Abas -->
    <div class="flex mb-4 space-x-2">
      <button class="tab-btn bg-indigo-500 text-white px-4 py-2 rounded" data-tab="participantes">Participantes</button>
      <button class="tab-btn bg-gray-200 px-4 py-2 rounded" data-tab="palpiteiros">Palpiteiros</button>
      <button class="tab-btn bg-gray-200 px-4 py-2 rounded" data-tab="gabarito">Gabarito</button>
      <button class="tab-btn bg-gray-200 px-4 py-2 rounded" data-tab="ranking">Ranking</button>
    </div>

    <!-- Conteúdo das abas -->
    <div id="tab-content">

      <!-- Participantes -->
      <div id="participantes" class="tab-content bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Gerenciar Participantes</h2>
        <form id="add-participante" class="mb-4 flex space-x-2">
          <input type="text" id="participante-nome" placeholder="Nome do participante" class="flex-1 p-2 border rounded">
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Adicionar</button>
        </form>
        <ul id="participante-list" class="space-y-2"></ul>
      </div>

      <!-- Palpiteiros -->
      <div id="palpiteiros" class="tab-content hidden bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Gerenciar Palpiteiros</h2>
        <form id="add-palpiteiro" class="mb-4 flex space-x-2">
          <input type="text" id="palpiteiro-nome" placeholder="Nome do palpiteiro" class="flex-1 p-2 border rounded">
          <input type="date" id="palpiteiro-nascimento" class="p-2 border rounded">
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Adicionar</button>
        </form>
        <ul id="palpiteiro-list" class="space-y-2"></ul>
      </div>

      <!-- Gabarito -->
      <div id="gabarito" class="tab-content hidden bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Cadastrar Gabarito da Semana</h2>
        <form id="gabarito-form" class="space-y-3">
          <input type="number" id="gabarito-semana" placeholder="Semana" class="w-32 p-2 border rounded">
          
          <div>
            <label>Líder(es):</label>
            <select id="gabarito-lider" multiple class="w-full border p-2 rounded"></select>
          </div>

          <div>
            <label>Anjo(s):</label>
            <select id="gabarito-anjo" multiple class="w-full border p-2 rounded"></select>
          </div>

          <div>
            <label>Imune(s):</label>
            <select id="gabarito-imune" multiple class="w-full border p-2 rounded"></select>
          </div>

          <div>
            <label>Emparedado(s):</label>
            <select id="gabarito-emparedado" multiple class="w-full border p-2 rounded"></select>
          </div>

          <div>
            <label>Bate-Volta(s):</label>
            <select id="gabarito-batevolta" multiple class="w-full border p-2 rounded"></select>
          </div>

          <div>
            <label>Eliminado(s):</label>
            <select id="gabarito-eliminado" multiple class="w-full border p-2 rounded"></select>
          </div>

          <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Salvar Gabarito</button>
        </form>
      </div>

      <!-- Ranking -->
      <div id="ranking" class="tab-content hidden bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Ranking Geral</h2>
        <div id="ranking-list" class="space-y-2"></div>
        <canvas id="ranking-chart" class="mt-4"></canvas>
      </div>

    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let adminUser = 'admin';
let adminPass = 'admin';

// abas
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.replace('bg-indigo-500','bg-gray-200'));
    btn.classList.replace('bg-gray-200','bg-indigo-500');
    const tab = btn.dataset.tab;
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.add('hidden'));
    document.getElementById(tab).classList.remove('hidden');
  });
});

// login
document.getElementById('login-form').addEventListener('submit', (e) => {
  e.preventDefault();
  const user = document.getElementById('admin-username').value;
  const pass = document.getElementById('admin-password').value;
  if(user === adminUser && pass === adminPass){
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    carregarParticipantes();
    carregarPalpiteiros();
    carregarGabaritoSelects();
    carregarRanking();
  } else {
    document.getElementById('login-error').classList.remove('hidden');
  }
});

// Funções para carregar e salvar dados via Supabase
async function carregarParticipantes(){
  const { data } = await supabase.from('participantes').select('*');
  const ul = document.getElementById('participante-list');
  ul.innerHTML = '';
  data.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.id} - ${p.nome}`;
    ul.appendChild(li);
  });
}

document.getElementById('add-participante').addEventListener('submit', async e=>{
  e.preventDefault();
  const nome = document.getElementById('participante-nome').value;
  await supabase.from('participantes').insert([{nome, ativo:true}]);
  document.getElementById('participante-nome').value='';
  carregarParticipantes();
});

async function carregarPalpiteiros(){
  const { data } = await supabase.from('palpiteiros').select('*');
  const ul = document.getElementById('palpiteiro-list');
  ul.innerHTML='';
  data.forEach(p=>{
    const li = document.createElement('li');
    li.textContent = `${p.id} - ${p.nome}`;
    ul.appendChild(li);
  });
}

document.getElementById('add-palpiteiro').addEventListener('submit', async e=>{
  e.preventDefault();
  const nome = document.getElementById('palpiteiro-nome').value;
  const nascimento = document.getElementById('palpiteiro-nascimento').value;
  await supabase.from('palpiteiros').insert([{nome, nascimento}]);
  document.getElementById('palpiteiro-nome').value='';
  document.getElementById('palpiteiro-nascimento').value='';
  carregarPalpiteiros();
});

// Gabarito
async function carregarGabaritoSelects(){
  const { data } = await supabase.from('participantes').select('*');
  const campos = ['lider','anjo','imune','emparedado','batevolta','eliminado'];
  campos.forEach(c=>{
    const sel = document.getElementById('gabarito-'+c);
    sel.innerHTML='';
    data.forEach(p=>{
      const option = document.createElement('option');
      option.value=p.id;
      option.textContent=p.nome;
      sel.appendChild(option);
    });
  });
}

document.getElementById('gabarito-form').addEventListener('submit', async e=>{
  e.preventDefault();
  const semana = parseInt(document.getElementById('gabarito-semana').value);
  const gabarito = {
    semana,
    lider: Array.from(document.getElementById('gabarito-lider').selectedOptions).map(o=>parseInt(o.value)),
    anjo: Array.from(document.getElementById('gabarito-anjo').selectedOptions).map(o=>parseInt(o.value)),
    imune: Array.from(document.getElementById('gabarito-imune').selectedOptions).map(o=>parseInt(o.value)),
    emparedados: Array.from(document.getElementById('gabarito-emparedado').selectedOptions).map(o=>parseInt(o.value)),
    bate_volta: Array.from(document.getElementById('gabarito-batevolta').selectedOptions).map(o=>parseInt(o.value)),
    eliminados: Array.from(document.getElementById('gabarito-eliminado').selectedOptions).map(o=>parseInt(o.value)),
    criado_em: new Date()
  };
  await supabase.from('gabaritos').insert([gabarito]);
  alert('Gabarito salvo!');
  document.getElementById('gabarito-form').reset();
});

// Ranking
async function carregarRanking(){
  // Exemplo simples: total de pontos por palpiteiro
  const { data } = await supabase.from('palpiteiros').select('*');
  const rankingDiv = document.getElementById('ranking-list');
  rankingDiv.innerHTML='';
  data.forEach((p,i)=>{
    const div = document.createElement('div');
    div.textContent = `${i+1} - ${p.nome} - ${p.pontos || 0} pts`;
    rankingDiv.appendChild(div);
  });
}
</script>

</body>
</html>