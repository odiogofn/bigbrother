<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin - Grande Irmão</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
body{font-family:Arial,sans-serif;margin:20px;background:#f9f9f9;}
.hidden{display:none;}
nav{margin-bottom:20px;}
nav button{margin-right:10px;padding:8px 12px;border-radius:5px;border:none;background:#007bff;color:white;cursor:pointer;}
nav button:hover{background:#0056b3;}
.card{background:white;padding:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);margin-bottom:20px;}
input,select{padding:5px;margin-bottom:10px;width:100%;max-width:300px;}
table{border-collapse:collapse;margin-top:10px;width:100%;max-width:800px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#eee;}
button.submit{background:#28a745;color:white;border:none;padding:6px 10px;border-radius:5px;cursor:pointer;}
button.submit:hover{background:#218838;}
</style>
</head>
<body>

<section id="login-section">
  <h2>Login Admin</h2>
  <form id="login-form">
    <label>Usuário:</label><br>
    <input type="text" id="username" required><br>
    <label>Senha:</label><br>
    <input type="password" id="password" required><br><br>
    <button type="submit">Entrar</button>
  </form>
</section>

<section id="dashboard" class="hidden">
  <h2>Painel Admin</h2>
  <nav>
    <button onclick="showTab('tab-participantes')">Participantes</button>
    <button onclick="showTab('tab-jogadores')">Palpiteiros</button>
    <button onclick="showTab('tab-gabarito')">Gabarito</button>
  </nav>

  <!-- Participantes -->
  <div id="tab-participantes" class="card">
    <h3>Cadastrar Participante</h3>
    <form id="form-participante">
      <input type="text" id="nome-participante" placeholder="Nome do participante" required>
      <button type="submit" class="submit">Salvar</button>
    </form>
    <ul id="lista-participantes"></ul>
  </div>

  <!-- Jogadores / Palpiteiros -->
  <div id="tab-jogadores" class="card hidden">
    <h3>Cadastrar Palpiteiro</h3>
    <form id="form-jogador">
      <input type="text" id="nome-jogador" placeholder="Nome do jogador" required>
      <input type="date" id="nascimento-jogador" required>
      <button type="submit" class="submit">Salvar</button>
    </form>
    <ul id="lista-jogadores"></ul>
  </div>

  <!-- Gabarito -->
  <div id="tab-gabarito" class="card hidden">
    <h3>Resultados por Semana</h3>
    <label>Semana:</label>
    <input type="number" id="semana-gabarito" min="1" value="1"><br>
    <table id="tabela-participantes">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Líder</th>
          <th>Anjo</th>
          <th>Emparedado</th>
          <th>Eliminado</th>
          <th>Bate Volta</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="salvar-gabarito" class="submit">Salvar Resultados</button>
  </div>
</section>

<script>
let supabase;

// Função para mostrar abas
function showTab(id){
  document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// LOGIN ADMIN
document.getElementById('login-form').addEventListener('submit', e=>{
  e.preventDefault();
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value.trim();
  if(u==='admin' && p==='admin'){
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    initAdminDashboard();
  } else alert('Usuário ou senha incorretos!');
});

// Inicializa Supabase e carrega dados
function initAdminDashboard(){
  const SUPABASE_URL='https://biojnilbgzozmynemtra.supabase.co';
  const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpb2puaWxiZ3pvem15bmVtdHJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDM5MzEsImV4cCI6MjA3MjIxOTkzMX0.F8MyL33SdQ7RViOF5RWgoZh8vC6hsyNqmqUXmRcNPDM';
  supabase = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
  carregarParticipantes();
  carregarJogadores();
}

// Participantes
document.getElementById('form-participante').addEventListener('submit', async e=>{
  e.preventDefault();
  const nome=document.getElementById('nome-participante').value.trim();
  const {error}=await supabase.from('participantes').insert([{nome, ativo:true}]);
  if(error){console.error(error); alert('Erro!'); return;}
  document.getElementById('form-participante').reset();
  carregarParticipantes();
});

async function carregarParticipantes(){
  const {data,error}=await supabase.from('participantes').select('*').eq('ativo',true).order('nome');
  if(error){console.error(error); return;}
  const ul=document.getElementById('lista-participantes'); ul.innerHTML='';
  const tbody=document.querySelector('#tabela-participantes tbody'); tbody.innerHTML='';
  data.forEach(p=>{
    const li=document.createElement('li'); li.textContent=p.nome; ul.appendChild(li);
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${p.nome}</td>
      <td><input type="checkbox" class="lider" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="anjo" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="emparedado" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="eliminado" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="bateVolta" data-nome="${p.nome}"></td>
    `;
    tbody.appendChild(tr);
  });
}

// Jogadores
document.getElementById('form-jogador').addEventListener('submit', async e=>{
  e.preventDefault();
  const nome=document.getElementById('nome-jogador').value.trim();
  const nascimento=document.getElementById('nascimento-jogador').value;
  const {error}=await supabase.from('jogadores').insert([{nome,nascimento}]);
  if(error){console.error(error); alert('Erro!'); return;}
  document.getElementById('form-jogador').reset();
  carregarJogadores();
});

async function carregarJogadores(){
  const {data,error}=await supabase.from('jogadores').select('*').order('nome');
  if(error){console.error(error); return;}
  const ul=document.getElementById('lista-jogadores'); ul.innerHTML='';
  data.forEach(j=>{const li=document.createElement('li'); li.textContent=`${j.nome} - ${j.nascimento}`; ul.appendChild(li);});
}

// Salvar Gabarito
document.getElementById('salvar-gabarito').addEventListener('click', async ()=>{
  const semana=parseInt(document.getElementById('semana-gabarito').value);
  if(isNaN(semana)||semana<1){alert('Informe semana válida');return;}
  const tbody=document.querySelector('#tabela-participantes tbody');
  const resultados=[];
  tbody.querySelectorAll('tr').forEach(tr=>{
    const nome=tr.cells[0].textContent;
    const lider=tr.querySelector('.lider').checked?[nome]:[];
    const anjo=tr.querySelector('.anjo').checked?[nome]:[];
    const emparedados=tr.querySelector('.emparedado').checked?[nome]:[];
    const eliminados=tr.querySelector('.eliminado').checked?[nome]:[];
    const bateVolta=tr.querySelector('.bateVolta').checked?[nome]:[];
    resultados.push({semana,lider:lider[0]||null,anjo:anjo[0]||null,emparedados,eliminados,bate_volta:bateVolta[0]||null});
  });
  const {error}=await supabase.from('resultados').insert(resultados);
  if(error){console.error(error); alert('Erro ao salvar!'); return;}
  alert('Gabarito salvo!');
});
</script>
</body>
</html>
