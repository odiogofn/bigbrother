<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Grande Irmão - Admin</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-6xl mx-auto">

  <!-- LOGIN -->
  <div id="loginDiv" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-xl">
    <h1 class="text-3xl font-bold mb-6 text-center">Login Admin</h1>
    <input type="text" id="login" placeholder="Login" class="border rounded-xl px-4 py-3 w-full mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
    <input type="password" id="senha" placeholder="Senha" class="border rounded-xl px-4 py-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
    <button id="btnLogin" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition">Entrar</button>
    <p id="msgLogin" class="mt-3 text-center"></p>
  </div>

  <!-- PAINEL ADMIN -->
  <div id="adminContent" class="hidden mt-6">

    <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Painel Admin</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- CADASTRO PARTICIPANTE -->
      <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition">
        <h2 class="text-xl font-semibold mb-4">Cadastrar Participante</h2>
        <input type="text" id="novoParticipante" placeholder="Nome do participante" class="border rounded-xl px-4 py-2 w-full mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button id="adicionarParticipante" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 rounded-xl transition">Adicionar</button>
        <p id="msgParticipante" class="mt-3 text-center"></p>
      </div>

      <!-- LANÇAR RESULTADOS -->
      <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition">
        <h2 class="text-xl font-semibold mb-4">Lançar Resultado da Semana</h2>

        <div class="mb-3">
          <label class="block font-medium mb-1">Semana</label>
          <input type="number" id="semana" class="border rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div class="mb-3">
          <label class="block font-medium mb-1">Líder</label>
          <select id="lider" multiple class="border rounded-xl px-4 py-2 w-full"></select>
        </div>

        <div class="mb-3">
          <label class="block font-medium mb-1">Anjo</label>
          <select id="anjo" multiple class="border rounded-xl px-4 py-2 w-full"></select>
        </div>

        <div class="mb-3">
          <label class="block font-medium mb-1">Emparedados</label>
          <select id="emparedados" multiple class="border rounded-xl px-4 py-2 w-full"></select>
        </div>

        <div class="mb-3">
          <label class="block font-medium mb-1">Eliminados</label>
          <select id="eliminados" multiple class="border rounded-xl px-4 py-2 w-full"></select>
        </div>

        <div class="mb-3">
          <label class="block font-medium mb-1">Bate-Volta</label>
          <select id="bateVolta" multiple class="border rounded-xl px-4 py-2 w-full"></select>
        </div>

        <button id="salvar" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-xl transition">Salvar Resultado</button>
        <p id="msg" class="mt-3 text-center font-medium"></p>
      </div>

    </div>
  </div>

</div>

<script>
const supabaseUrl = "https://biojnilbgzozmynemtra.supabase.co
";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpb2puaWxiZ3pvem15bmVtdHJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDM5MzEsImV4cCI6MjA3MjIxOTkzMX0.F8MyL33SdQ7RViOF5RWgoZh8vC6hsyNqmqUXmRcNPDM";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// LOGIN ADMIN
document.getElementById("btnLogin").addEventListener("click", () => {
  const login = document.getElementById("login").value;
  const senha = document.getElementById("senha").value;
  if(login === "admin" && senha === "admin"){
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminContent").classList.remove("hidden");
    preencherSelects();
  } else {
    const msg = document.getElementById("msgLogin");
    msg.textContent = "Login ou senha incorretos";
    msg.className = "mt-3 text-red-600 text-center font-medium";
  }
});

// CARREGAR PARTICIPANTES ATIVOS
async function carregarParticipantes() {
  const { data, error } = await supabase
    .from("participantes")
    .select("nome")
    .eq("ativo", true)
    .order("nome");

  if(error){ alert("Erro ao carregar participantes: " + error.message); return []; }
  return data.map(p => p.nome);
}

async function preencherSelects() {
  const participantes = await carregarParticipantes();
  ["lider","anjo","emparedados","eliminados","bateVolta"].forEach(id => {
    const sel = document.getElementById(id);
    sel.innerHTML = "";
    participantes.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = p;
      sel.appendChild(opt);
    });
  });
}

// ADICIONAR PARTICIPANTE
document.getElementById("adicionarParticipante").addEventListener("click", async () => {
  const nome = document.getElementById("novoParticipante").value.trim();
  if(!nome){ alert("Digite o nome"); return; }

  const { data, error } = await supabase
    .from("participantes")
    .insert([{ nome, ativo: true, criado_em: new Date().toISOString() }]);

  const msg = document.getElementById("msgParticipante");
  if(error){
    msg.textContent = "Erro: " + error.message;
    msg.className = "mt-3 text-red-600 text-center font-medium";
  } else {
    msg.textContent = "Participante adicionado!";
    msg.className = "mt-3 text-green-600 text-center font-medium";
    document.getElementById("novoParticipante").value = "";
    preencherSelects();
  }
});

// SALVAR RESULTADOS
document.getElementById("salvar").addEventListener("click", async () => {
  const semana = parseInt(document.getElementById("semana").value);
  if(!semana){ alert("Informe a semana"); return; }

  const payload = {
    semana,
    lider: Array.from(document.getElementById("lider").selectedOptions).map(o=>o.value),
    anjo: Array.from(document.getElementById("anjo").selectedOptions).map(o=>o.value),
    emparedados: Array.from(document.getElementById("emparedados").selectedOptions).map(o=>o.value),
    eliminados: Array.from(document.getElementById("eliminados").selectedOptions).map(o=>o.value),
    bate_volta: Array.from(document.getElementById("bateVolta").selectedOptions).map(o=>o.value),
    criado_em: new Date().toISOString()
  };

  const { data, error } = await supabase
    .from("resultados")
    .insert([payload]);

  const msg = document.getElementById("msg");
  if(error){
    msg.textContent = "Erro ao salvar: " + error.message;
    msg.className = "mt-3 text-red-600 text-center font-medium";
  } else {
    msg.textContent = "Semana salva com sucesso!";
    msg.className = "mt-3 text-green-600 text-center font-medium";
  }
});
</script>
</body>
</html>
