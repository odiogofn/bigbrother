<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Área do Palpiteiro - Grande Irmão</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
body{font-family:Arial,sans-serif;background:#f0f2f5;margin:0;padding:0;display:flex;justify-content:center;align-items:center;height:100vh;}
.container{background:white;padding:30px;border-radius:10px;box-shadow:0 3px 10px rgba(0,0,0,0.15);width:100%;max-width:500px;}
h2{margin-bottom:20px;text-align:center;}
input,select{padding:8px;margin-bottom:10px;width:100%;border-radius:5px;border:1px solid #ccc;}
button{padding:10px 15px;border:none;border-radius:6px;background:#007bff;color:white;cursor:pointer;font-size:16px;}
button:hover{background:#0056b3;}
.hidden{display:none;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#eee;}
</style>
</head>
<body>

<div class="container">
  <!-- Login Palpiteiro -->
  <section id="login-section">
    <h2>Login Palpiteiro</h2>
    <form id="login-form">
      <input type="text" id="nome" placeholder="Nome" required>
      <input type="date" id="nascimento" required>
      <button type="submit">Entrar</button>
    </form>
  </section>

  <!-- Painel Palpiteiro -->
  <section id="painel" class="hidden">
    <h2>Área do Palpiteiro</h2>
    <label>Semana:</label>
    <input type="number" id="semana" min="1" value="1"><br>

    <table id="tabela-participantes">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Líder</th>
          <th>Anjo</th>
          <th>Emparedado</th>
          <th>Eliminado</th>
          <th>Bate Volta</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="salvar-palpites">Salvar Palpites</button>
  </section>
</div>

<script>
const SUPABASE_URL='https://biojnilbgzozmynemtra.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // use sua chave completa
const supabase = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let jogador_id = null;

// LOGIN PALPITEIRO
document.getElementById('login-form').addEventListener('submit', async e=>{
  e.preventDefault();
  const nome=document.getElementById('nome').value.trim();
  const nascimento=document.getElementById('nascimento').value;
  const {data,error}=await supabase.from('jogadores').select('*').eq('nome',nome).eq('nascimento',nascimento).single();
  if(error || !data){ alert('Nome ou data de nascimento incorretos!'); return;}
  jogador_id = data.id;
  document.getElementById('login-section').classList.add('hidden');
  document.getElementById('painel').classList.remove('hidden');
  carregarParticipantes();
});

// CARREGAR PARTICIPANTES
async function carregarParticipantes(){
  const {data,error}=await supabase.from('participantes').select('*').eq('ativo',true).order('nome');
  if(error){ console.error(error); return; }
  const tbody=document.querySelector('#tabela-participantes tbody');
  tbody.innerHTML='';
  data.forEach(p=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${p.nome}</td>
      <td><input type="checkbox" class="lider" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="anjo" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="emparedado" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="eliminado" data-nome="${p.nome}"></td>
      <td><input type="checkbox" class="bateVolta" data-nome="${p.nome}"></td>
    `;
    tbody.appendChild(tr);
  });
}

// SALVAR PALPITES
document.getElementById('salvar-palpites').addEventListener('click', async ()=>{
  const semana=parseInt(document.getElementById('semana').value);
  if(isNaN(semana)||semana<1){alert('Informe uma semana válida'); return;}
  const tbody=document.querySelector('#tabela-participantes tbody');
  const palpites=[];
  tbody.querySelectorAll('tr').forEach(tr=>{
    const nome=tr.cells[0].textContent;
    const lider=tr.querySelector('.lider').checked?[nome]:[];
    const anjo=tr.querySelector('.anjo').checked?[nome]:[];
    const emparedados=tr.querySelector('.emparedado').checked?[nome]:[];
    const eliminado=tr.querySelector('.eliminado').checked?[nome]:[];
    const bateVolta=tr.querySelector('.bateVolta').checked?[nome]:[];
    palpites.push({
      jogador_id,
      semana,
      lider: lider[0]||null,
      anjo: anjo[0]||null,
      emparedados,
      eliminado,
      bate_volta: bateVolta[0]||null
    });
  });
  const {error}=await supabase.from('palpites').insert(palpites);
  if(error){ console.error(error); alert('Erro ao salvar palpites!'); return;}
  alert('Palpites salvos com sucesso!');
});
</script>
</body>
</html>
