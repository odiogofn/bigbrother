<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Área do Palpiteiro</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co"; // troque pelo seu
    const SUPABASE_KEY = "YOUR_PUBLIC_ANON_KEY"; // troque pelo seu
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>
  <style>
    body { font-family:Arial, sans-serif; background:#f4f6f9; margin:0; padding:20px; }
    .container { max-width:900px; margin:auto; background:white; padding:30px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h2 { text-align:center; margin-bottom:20px; }
    form { display:grid; gap:15px; }
    label { font-weight:bold; }
    select { padding:10px; border:1px solid #ccc; border-radius:6px; }
    button { padding:12px; border:none; border-radius:8px; cursor:pointer; background:#007bff; color:white; font-weight:bold; }
    button:hover { background:#0056b3; }
    table { width:100%; border-collapse:collapse; margin-top:30px; }
    th, td { border:1px solid #ddd; padding:10px; text-align:left; }
    th { background:#f1f3f6; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Área do Palpiteiro</h2>
    <form id="formPalpite">
      <label for="palpiteiro">Selecione seu nome:</label>
      <select id="palpiteiro" required></select>

      <label>Líder:</label>
      <select id="lider"></select>

      <label>Anjo:</label>
      <select id="anjo"></select>

      <label>Emparedado:</label>
      <select id="emparedado" multiple></select>

      <label>Eliminado:</label>
      <select id="eliminado"></select>

      <label>Bate e Volta:</label>
      <select id="batevolta"></select>

      <button type="submit">Salvar Palpite</button>
    </form>

    <h3>Meus Palpites</h3>
    <table id="tabelaPalpites">
      <thead>
        <tr><th>Data</th><th>Líder</th><th>Anjo</th><th>Emparedado</th><th>Eliminado</th><th>Bate e Volta</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const palpiteiroSelect = document.getElementById("palpiteiro");
    const participantesSelects = ["lider","anjo","emparedado","eliminado","batevolta"];

    // carregar palpiteiros
    async function carregarPalpiteiros(){
      const { data } = await supabase.from("palpiteiros").select("*");
      palpiteiroSelect.innerHTML = "<option value=''>Selecione</option>";
      data.forEach(p => palpiteiroSelect.innerHTML += `<option value="${p.id}">${p.nome}</option>`);
    }

    // carregar participantes
    async function carregarParticipantes(){
      const { data } = await supabase.from("participantes").select("*");
      participantesSelects.forEach(id=>{
        const sel=document.getElementById(id);
        sel.innerHTML = "<option value=''>Selecione</option>";
        data.forEach(p=> sel.innerHTML += `<option value="${p.id}">${p.nome}</option>`);
      });
    }

    // salvar palpite
    document.getElementById("formPalpite").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const palpiteiro_id = palpiteiroSelect.value;
      if(!palpiteiro_id) return alert("Selecione o palpiteiro!");

      const lider = document.getElementById("lider").value;
      const anjo = document.getElementById("anjo").value;
      const emparedado = Array.from(document.getElementById("emparedado").selectedOptions).map(o=>o.value);
      const eliminado = document.getElementById("eliminado").value;
      const batevolta = document.getElementById("batevolta").value;

      await supabase.from("palpites").insert([{
        palpiteiro_id, lider, anjo, emparedado, eliminado, batevolta, data:new Date().toISOString()
      }]);
      carregarPalpites(palpiteiro_id);
    });

    // carregar palpites do palpiteiro
    async function carregarPalpites(palpiteiro_id){
      const { data } = await supabase.from("palpites").select("*").eq("palpiteiro_id", palpiteiro_id);
      const tbody = document.querySelector("#tabelaPalpites tbody");
      tbody.innerHTML="";
      data.forEach(p=>{
        tbody.innerHTML += `
          <tr>
            <td>${new Date(p.data).toLocaleString()}</td>
            <td>${p.lider||""}</td>
            <td>${p.anjo||""}</td>
            <td>${(p.emparedado||[]).join(", ")}</td>
            <td>${p.eliminado||""}</td>
            <td>${p.batevolta||""}</td>
          </tr>`;
      });
    }

    palpiteiroSelect.addEventListener("change", ()=>carregarPalpites(palpiteiroSelect.value));

    carregarPalpiteiros();
    carregarParticipantes();
  </script>
</body>
</html>

