<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Resultados</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-3xl">
    <h1 class="text-2xl font-bold text-center text-indigo-600 mb-6">Cadastro de Resultados Semanais</h1>

    <!-- Formulário -->
    <form id="formResultado" class="space-y-4">
      <div>
        <label class="block text-gray-700">Semana</label>
        <input type="number" id="semana" class="w-full border rounded-lg p-2" required>
      </div>

      <div>
        <label class="block text-gray-700">Líder</label>
        <input type="text" id="lider" class="w-full border rounded-lg p-2" required>
      </div>

      <div>
        <label class="block text-gray-700">Anjo</label>
        <input type="text" id="anjo" class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block text-gray-700">Emparedados (separar por vírgula)</label>
        <input type="text" id="emparedados" class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block text-gray-700">Eliminados (separar por vírgula)</label>
        <input type="text" id="eliminados" class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block text-gray-700">Bate-volta</label>
        <input type="text" id="bate_volta" class="w-full border rounded-lg p-2">
      </div>

      <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
        Salvar Resultado
      </button>
    </form>

    <!-- Lista de Resultados -->
    <h2 class="text-xl font-semibold text-gray-700 mt-8">Resultados Cadastrados</h2>
    <div id="listaResultados" class="mt-4 space-y-2"></div>
  </div>

  <script>
    const SUPABASE_URL = "https://biojnilbgzozmynemtra.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpb2puaWxiZ3pvem15bmVtdHJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDM5MzEsImV4cCI6MjA3MjIxOTkzMX0.F8MyL33SdQ7RViOF5RWgoZh8vC6hsyNqmqUXmRcNPDM";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Salvar resultado
    document.getElementById("formResultado").addEventListener("submit", async (e) => {
      e.preventDefault();

      const semana = document.getElementById("semana").value;
      const lider = document.getElementById("lider").value;
      const anjo = document.getElementById("anjo").value;
      const emparedados = document.getElementById("emparedados").value.split(",").map(s => s.trim());
      const eliminados = document.getElementById("eliminados").value.split(",").map(s => s.trim());
      const bate_volta = document.getElementById("bate_volta").value;

      const { data, error } = await supabase
        .from("resultados")
        .insert([{
          semana,
          lider,
          anjo,
          emparedados,
          eliminados,
          bate_volta,
          criado_em: new Date()
        }]);

      if (error) {
        alert("Erro ao salvar: " + error.message);
      } else {
        alert("Resultado salvo com sucesso!");
        carregarResultados();
        e.target.reset();
      }
    });

    // Carregar lista
    async function carregarResultados() {
      const { data, error } = await supabase
        .from("resultados")
        .select("*")
        .order("semana", { ascending: true });

      if (error) {
        console.error(error);
        return;
      }

      const lista = document.getElementById("listaResultados");
      lista.innerHTML = "";
      data.forEach(r => {
        const div = document.createElement("div");
        div.className = "p-4 border rounded-lg bg-gray-50";
        div.innerHTML = `
          <p><strong>Semana:</strong> ${r.semana}</p>
          <p><strong>Líder:</strong> ${r.lider}</p>
          <p><strong>Anjo:</strong> ${r.anjo || "-"}</p>
          <p><strong>Emparedados:</strong> ${r.emparedados?.join(", ") || "-"}</p>
          <p><strong>Eliminados:</strong> ${r.eliminados?.join(", ") || "-"}</p>
          <p><strong>Bate-volta:</strong> ${r.bate_volta || "-"}</p>
        `;
        lista.appendChild(div);
      });
    }

    carregarResultados();
  </script>
</body>
</html>
