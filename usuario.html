<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Grande Irmão - Palpites</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">
  <h1 class="text-2xl font-bold mb-4">Enviar Palpites</h1>

  <!-- Login simples -->
  <div class="mb-6">
    <label class="block font-medium mb-1">Nome</label>
    <input type="text" id="usuario" class="w-full border rounded-xl px-3 py-2 mb-2">
    <label class="block font-medium mb-1">Data de Nascimento (senha)</label>
    <input type="date" id="senha" class="w-full border rounded-xl px-3 py-2">
  </div>

  <div class="mb-4">
    <label class="block font-medium mb-1">Semana</label>
    <input type="number" id="semana" class="w-full border rounded-xl px-3 py-2">
  </div>

  <!-- Palpites -->
  <div class="mb-4">
    <label class="block font-medium mb-1">Líder</label>
    <select id="lider" multiple class="w-full border rounded-xl px-3 py-2"></select>
  </div>

  <div class="mb-4">
    <label class="block font-medium mb-1">Anjo</label>
    <select id="anjo" multiple class="w-full border rounded-xl px-3 py-2"></select>
  </div>

  <div class="mb-4">
    <label class="block font-medium mb-1">Emparedados</label>
    <select id="emparedados" multiple class="w-full border rounded-xl px-3 py-2"></select>
  </div>

  <div class="mb-4">
    <label class="block font-medium mb-1">Eliminados</label>
    <select id="eliminados" multiple class="w-full border rounded-xl px-3 py-2"></select>
  </div>

  <div class="mb-4">
    <label class="block font-medium mb-1">Bate-Volta</label>
    <select id="bateVolta" multiple class="w-full border rounded-xl px-3 py-2"></select>
  </div>

  <button id="enviar" class="bg-green-600 text-white px-4 py-2 rounded-xl">Enviar Palpites</button>
  <p id="msg" class="mt-3 font-medium"></p>
</div>

<script>
const supabaseUrl = "https://SEU_SUPABASE_URL";
const supabaseKey = "SUA_CHAVE_ANONIMA";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// Carregar participantes ativos
async function preencherSelects() {
  const { data, error } = await supabase
    .from("participantes")
    .select("nome")
    .eq("ativo", true)
    .order("nome");
  if(error){ alert(error.message); return; }

  const participantes = data.map(p => p.nome);
  ["lider","anjo","emparedados","eliminados","bateVolta"].forEach(id => {
    const sel = document.getElementById(id);
    sel.innerHTML = "";
    participantes.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = p;
      sel.appendChild(opt);
    });
  });
}

preencherSelects();

// Enviar palpites
document.getElementById("enviar").addEventListener("click", async () => {
  const usuario = document.getElementById("usuario").value.trim();
  const senha = document.getElementById("senha").value;
  const semana = parseInt(document.getElementById("semana").value);

  if(!usuario || !senha || !semana){ 
    alert("Preencha todos os campos"); 
    return; 
  }

  const payload = {
    usuario,
    senha, 
    semana,
    lider: Array.from(document.getElementById("lider").selectedOptions).map(o=>o.value),
    anjo: Array.from(document.getElementById("anjo").selectedOptions).map(o=>o.value),
    emparedados: Array.from(document.getElementById("emparedados").selectedOptions).map(o=>o.value),
    eliminados: Array.from(document.getElementById("eliminados").selectedOptions).map(o=>o.value),
    bate_volta: Array.from(document.getElementById("bateVolta").selectedOptions).map(o=>o.value),
    criado_em: new Date().toISOString()
  };

  const { data, error } = await supabase
    .from("palpites")
    .insert([payload]);

  if(error){
    document.getElementById("msg").textContent = "Erro ao enviar: " + error.message;
    document.getElementById("msg").className = "mt-3 text-red-600 font-medium";
  } else {
    document.getElementById("msg").textContent = "Palpite enviado com sucesso!";
    document.getElementById("msg").className = "mt-3 text-green-600 font-medium";
    document.getElementById("semana").value = "";
    ["lider","anjo","emparedados","eliminados","bateVolta"].forEach(id => document.getElementById(id).selectedIndex = -1);
  }
});
</script>
</body>
</html>
