<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gigant Brother - Ranking Público</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
<script src="supabase.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">

<div class="max-w-4xl mx-auto p-4">

  <h1 class="text-3xl font-bold text-center text-indigo-600 mb-6">Ranking Público - Gigant Brother</h1>

  <div class="bg-white p-6 rounded shadow mb-6">
    <h2 class="text-xl font-semibold mb-4">Ranking Geral</h2>
    <div id="ranking-list"></div>
  </div>

  <div class="bg-white p-6 rounded shadow">
    <h2 class="text-xl font-semibold mb-4">Evolução de Pontos</h2>
    <canvas id="grafico-evolucao"></canvas>
  </div>

</div>

<script>
async function carregarRanking(){
  const { data } = await supabase.from('palpiteiros').select('*').order('pontos', { ascending: false });
  const div = document.getElementById('ranking-list');
  div.innerHTML='';
  data.forEach((p,i)=>{
    const d = document.createElement('div');
    d.className='border-b p-2';
    d.textContent = `${i+1} - ${p.nome} - ${p.pontos || 0} pts`;
    div.appendChild(d);
  });

  // gráfico de evolução (média de pontos por semana)
  const semanas = [...Array(10).keys()].map(i=>i+1); // exemplo 10 semanas
  const datasets = data.map(p=>({
    label: p.nome,
    data: Array(10).fill(p.pontos/10), // exemplo simplificado
    borderColor: `hsl(${Math.random()*360},70%,50%)`,
    backgroundColor: 'transparent',
    tension: 0.3
  }));
  const ctx = document.getElementById('grafico-evolucao').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: { labels: semanas.map(s=>'Semana '+s), datasets },
    options: { responsive:true, plugins:{legend:{display:true}} }
  });
}

carregarRanking();
</script>

</body>
</html>
