<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ranking - Gigant Brother</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="supabase.js"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-bold text-green-700 mb-6">Ranking Geral - Gigant Brother</h1>
  <div id="ranking" class="mb-6"></div>
  <canvas id="grafico"></canvas>

  <script type="module">
    import { supabase } from './supabase.js';

    async function carregarRanking() {
      let { data } = await supabase.rpc("ranking_geral");
      document.getElementById("ranking").innerHTML = `
        <table class="w-full bg-white shadow rounded">
          <tr class="bg-green-600 text-white">
            <th class="p-2">Posição</th>
            <th class="p-2">Nome</th>
            <th class="p-2">Pontos</th>
          </tr>
          ${data.map((p,i)=>`
            <tr class="border-t">
              <td class="p-2">${i+1}</td>
              <td class="p-2">${p.nome}</td>
              <td class="p-2">${p.pontos}</td>
            </tr>`).join("")}
        </table>
      `;

      const ctx = document.getElementById("grafico").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: data.map(p => p.nome),
          datasets: [{
            label: "Pontos",
            data: data.map(p => p.pontos),
            backgroundColor: "green"
          }]
        }
      });
    }

    carregarRanking();
  </script>
</body>
</html>
